<div class="container">
  <div class="playground-ui">
    <div style="float: left; width: 25%; padding-right: 1em; font-size: 0.85em;">
      <h3>Status</h3>
      <p><strong>Server:</strong> <span id="status">Checking...</span></p>
      <p><strong>Model:</strong> <span id="model">Loading...</span></p>
    </div>

    <div style="float: left; width: 75%; padding-left: 1em;">
      <h1>AI Coding Playground</h1>
      <p>This interface sends requests to a running LLM instance. Try a prompt like:</p>
      <pre>Write an Arduino program that reads temperature and displays it on an LCD.</pre>

      <label for="promptVersion">Prompt Style:</label>
      <select id="promptVersion" style="width: 100%;">
        <option value="deepseek">DeepSeek (Arduino Expert)</option>
        <option value="default">Default (No System Prompt)</option>
      </select>

      <label for="prompt">Your Prompt:</label>
      <textarea id="prompt" style="width: 100%; height: 5em;"></textarea>

      <button id="sendBtn" onclick="sendPrompt()" style="margin-top: 1em;">Send</button>
      <div class="loading" id="loading" style="display:none;">Thinking...</div>

      <h3>Response:</h3>
      <pre id="output" style="white-space: pre-wrap;"></pre>
    </div>
  </div>
</div>

<script>
  const BASE_URL = "https://rich-possible-seahorse.ngrok-free.app";

  window.addEventListener("DOMContentLoaded", () => {
    checkStatus();
    fetchModel();
  });

  async function sendPrompt() {
    const userPrompt = document.getElementById("prompt").value;
    const output = document.getElementById("output");
    const loading = document.getElementById("loading");
    const variant = document.getElementById("promptVersion").value;

    output.textContent = "";
    loading.style.display = "block";

    try {
      const formatRes = await fetch(`${BASE_URL}/format`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt: userPrompt, variant })
      });
      const { formatted } = await formatRes.json();

      const response = await fetch(`${BASE_URL}/completion`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          prompt: formatted,
          temperature: 0.7,
          max_tokens: 2048
        })
      });

      const data = await response.json();
      output.textContent = data.content || JSON.stringify(data, null, 2);
    } catch (err) {
      output.textContent = `Error: ${err.message}`;
    } finally {
      loading.style.display = "none";
    }
  }

async function fetchModel() {
  try {
    const res = await fetch(`${BASE_URL}/model`, {
      headers: {
        "ngrok-skip-browser-warning": "true"
      }
    });
    const data = await res.json();
    document.getElementById("model").textContent = data.model || "Unknown";
  } catch {
    document.getElementById("model").textContent = "Unavailable";
  }
}

  async function checkStatus() {
  try {
    const res = await fetch(`${BASE_URL}/health`, {
      method: "HEAD",
      headers: {
        "ngrok-skip-browser-warning": "true"
      }
    });
    document.getElementById("status").textContent = res.ok ? "ðŸŸ¢ Online" : "ðŸ”´ Offline";
  } catch {
    document.getElementById("status").textContent = "ðŸ”´ Offline";
  }
}
</script>
